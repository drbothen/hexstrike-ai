---
title: POST /api/visual/vulnerability-card
group: api
handler: generate_vulnerability_card
module: __main__
line_range: [7581, 7606]
discovered_in_chunk: 7
---

# POST /api/visual/vulnerability-card

## Entity Classification & Context
- **Kind:** Flask API endpoint
- **Scope:** Module-level
- **Module:** __main__ (reference-server.py)
- **Purpose:** Generate visual vulnerability card for reporting

## Complete Signature & Definition
```python
@app.route("/api/visual/vulnerability-card", methods=["POST"])
def generate_vulnerability_card():
    """Generate visual vulnerability card for reporting with enhanced logging"""
```

## Purpose & Behavior
Visual vulnerability card generation endpoint providing:
- **Card Generation:** Generate visual vulnerability cards for reporting
- **Customization:** Customize card appearance and content
- **Export Options:** Export cards in various formats
- **Enhanced Logging:** Detailed logging of card generation operations

## Request

### HTTP Method
- **Method:** POST
- **Path:** /api/visual/vulnerability-card
- **Content-Type:** application/json

### Request Body
```json
{
    "vulnerability": {
        "title": "string",            // Required: Vulnerability title
        "severity": "string",         // Required: Severity level
        "cvss_score": number,         // Optional: CVSS score
        "description": "string",      // Required: Vulnerability description
        "impact": "string",           // Optional: Impact description
        "remediation": "string",      // Optional: Remediation steps
        "references": ["string"],     // Optional: Reference URLs
        "affected_systems": ["string"], // Optional: Affected systems
        "discovery_date": "string",   // Optional: Discovery date
        "status": "string"            // Optional: Vulnerability status
    },
    "card_options": {
        "template": "string",         // Optional: Card template (default: standard)
        "color_scheme": "string",     // Optional: Color scheme (default: severity-based)
        "include_logo": boolean,      // Optional: Include organization logo (default: true)
        "include_qr_code": boolean,   // Optional: Include QR code (default: false)
        "format": "string",           // Optional: Output format (default: png)
        "size": "string"              // Optional: Card size (default: standard)
    },
    "branding": {
        "organization": "string",     // Optional: Organization name
        "logo_url": "string",         // Optional: Logo URL
        "contact_info": "string",     // Optional: Contact information
        "report_id": "string"         // Optional: Report ID
    }
}
```

### Parameters
- **vulnerability:** Vulnerability information (required)
  - **title:** Vulnerability title (required)
  - **severity:** Severity level (required) - "Critical", "High", "Medium", "Low"
  - **cvss_score:** CVSS score (optional) - 0.0 to 10.0
  - **description:** Vulnerability description (required)
  - **impact:** Impact description (optional)
  - **remediation:** Remediation steps (optional)
  - **references:** Reference URLs (optional)
  - **affected_systems:** Affected systems (optional)
  - **discovery_date:** Discovery date (optional)
  - **status:** Vulnerability status (optional) - "Open", "In Progress", "Resolved"
- **card_options:** Card customization options (optional)
  - **template:** Card template (optional, default: "standard")
  - **color_scheme:** Color scheme (optional, default: "severity-based")
  - **include_logo:** Include organization logo (optional, default: true)
  - **include_qr_code:** Include QR code (optional, default: false)
  - **format:** Output format (optional, default: "png") - "png", "pdf", "svg"
  - **size:** Card size (optional, default: "standard") - "small", "standard", "large"
- **branding:** Branding information (optional)

## Response

### Success Response (200 OK)
```json
{
    "success": true,
    "card_info": {
        "vulnerability_title": "SQL Injection in Login Form",
        "severity": "High",
        "cvss_score": 8.5,
        "template": "standard",
        "format": "png",
        "size": "standard"
    },
    "output": {
        "file_path": "/tmp/vuln_card_1234567890.png",
        "file_size": "256KB",
        "download_url": "/api/files/download/vuln_card_1234567890.png",
        "preview_url": "/api/files/preview/vuln_card_1234567890.png"
    },
    "generation_details": {
        "template_used": "standard",
        "color_scheme": "severity-high",
        "dimensions": "800x600",
        "generation_time": 2.3
    },
    "timestamp": "2024-01-01T12:00:00Z"
}
```

### Error Responses

#### Missing Required Fields (400 Bad Request)
```json
{
    "error": "Missing required fields: title, severity, description"
}
```

#### Invalid Severity (400 Bad Request)
```json
{
    "error": "Invalid severity. Must be one of: Critical, High, Medium, Low"
}
```

#### Server Error (500 Internal Server Error)
```json
{
    "error": "Server error: {error_message}"
}
```

## Implementation Details

### Parameter Validation
```python
params = request.json
vulnerability = params.get("vulnerability", {})
card_options = params.get("card_options", {})
branding = params.get("branding", {})

# Validate required vulnerability fields
required_fields = ["title", "severity", "description"]
missing_fields = [field for field in required_fields if not vulnerability.get(field)]
if missing_fields:
    return jsonify({"error": f"Missing required fields: {', '.join(missing_fields)}"}), 400

# Validate severity
valid_severities = ["Critical", "High", "Medium", "Low"]
if vulnerability["severity"] not in valid_severities:
    return jsonify({"error": f"Invalid severity. Must be one of: {', '.join(valid_severities)}"}), 400
```

### Card Generation Logic
```python
# Use ModernVisualEngine to generate card
card_data = {
    "vulnerability": vulnerability,
    "options": card_options,
    "branding": branding
}

# Generate card using visual engine
card_result = visual_engine.generate_vulnerability_card(card_data)

# Save card to file
output_file = f"/tmp/vuln_card_{int(time.time() * 1000000)}.{card_options.get('format', 'png')}"
card_result.save(output_file)
```

## AuthN/AuthZ
- **Authentication:** Not specified (appears to be open)
- **Authorization:** Visual card generation access required

## Error Handling
- **Missing Parameters:** 400 error for missing required fields
- **Invalid Parameters:** 400 error for invalid severity or format values
- **Generation Errors:** Handle errors during card generation
- **Server Errors:** 500 error with exception details

## Security Considerations
- **Input Validation:** Validate all input data for security
- **File Security:** Secure handling of generated card files
- **Resource Limits:** Implement resource limits for card generation
- **Access Control:** Control access to generated cards

## Use Cases and Applications

#### Vulnerability Reporting
- **Executive Reports:** Generate cards for executive vulnerability reports
- **Client Deliverables:** Create professional vulnerability cards for clients
- **Documentation:** Document vulnerabilities with visual cards

#### Presentation Materials
- **Security Briefings:** Create cards for security briefings and presentations
- **Training Materials:** Generate cards for security training materials
- **Compliance Reports:** Create cards for compliance and audit reports

## Testing & Validation
- Parameter validation accuracy testing
- Card generation functionality testing
- Output format verification testing
- Error handling behavior validation

## Code Reproduction
```python
@app.route("/api/visual/vulnerability-card", methods=["POST"])
def generate_vulnerability_card():
    """Generate visual vulnerability card for reporting with enhanced logging"""
    try:
        params = request.json
        vulnerability = params.get("vulnerability", {})
        card_options = params.get("card_options", {})
        branding = params.get("branding", {})
        
        # Validate required vulnerability fields
        required_fields = ["title", "severity", "description"]
        missing_fields = [field for field in required_fields if not vulnerability.get(field)]
        if missing_fields:
            return jsonify({"error": f"Missing required fields: {', '.join(missing_fields)}"}), 400
        
        # Validate severity
        valid_severities = ["Critical", "High", "Medium", "Low"]
        if vulnerability["severity"] not in valid_severities:
            return jsonify({"error": f"Invalid severity. Must be one of: {', '.join(valid_severities)}"}), 400
        
        logger.info(f"ðŸŽ¨ Generating vulnerability card: {vulnerability['title']} | Severity: {vulnerability['severity']}")
        
        start_time = time.time()
        
        # Use ModernVisualEngine to generate card
        card_data = {
            "vulnerability": vulnerability,
            "options": card_options,
            "branding": branding
        }
        
        # Generate card using visual engine
        card_result = visual_engine.generate_vulnerability_card(card_data)
        
        # Save card to file
        output_format = card_options.get("format", "png")
        output_file = f"/tmp/vuln_card_{int(time.time() * 1000000)}.{output_format}"
        card_result.save(output_file)
        
        generation_time = time.time() - start_time
        
        # Get file info
        file_size = os.path.getsize(output_file)
        file_size_str = f"{file_size / 1024:.0f}KB" if file_size < 1024*1024 else f"{file_size / (1024*1024):.1f}MB"
        
        card_info = {
            "vulnerability_title": vulnerability["title"],
            "severity": vulnerability["severity"],
            "cvss_score": vulnerability.get("cvss_score"),
            "template": card_options.get("template", "standard"),
            "format": output_format,
            "size": card_options.get("size", "standard")
        }
        
        output = {
            "file_path": output_file,
            "file_size": file_size_str,
            "download_url": f"/api/files/download/{os.path.basename(output_file)}",
            "preview_url": f"/api/files/preview/{os.path.basename(output_file)}"
        }
        
        generation_details = {
            "template_used": card_options.get("template", "standard"),
            "color_scheme": f"severity-{vulnerability['severity'].lower()}",
            "dimensions": card_result.get_dimensions(),
            "generation_time": generation_time
        }
        
        logger.info(f"ðŸŽ¨ Vulnerability card generated in {generation_time:.2f}s | File: {output_file}")
        
        return jsonify({
            "success": True,
            "card_info": card_info,
            "output": output,
            "generation_details": generation_details,
            "timestamp": datetime.now().isoformat()
        })
        
    except Exception as e:
        logger.error(f"ðŸ’¥ Error generating vulnerability card: {str(e)}")
        return jsonify({
            "error": f"Server error: {str(e)}"
        }), 500
```
